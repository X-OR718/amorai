<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amorai - Meet Sofia üíï</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Quicksand:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a25;
            --accent-pink: #ff6b9d;
            --accent-rose: #e8a87c;
            --accent-purple: #9d4edd;
            --accent-glow: rgba(255, 107, 157, 0.4);
            --text-primary: #ffffff;
            --text-secondary: #b0b0c0;
            --text-muted: #6a6a7a;
            --gradient-romantic: linear-gradient(135deg, #ff6b9d 0%, #c44569 50%, #9d4edd 100%);
            --gradient-bg: radial-gradient(ellipse at top, #1a1025 0%, #0a0a0f 50%, #050508 100%);
            --shadow-glow: 0 0 40px rgba(255, 107, 157, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: var(--gradient-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .landing-page::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, rgba(157, 78, 221, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 70% 70%, rgba(255, 107, 157, 0.1) 0%, transparent 50%);
            animation: aurora 20s ease-in-out infinite;
        }

        @keyframes aurora {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 700;
            background: var(--gradient-romantic);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
            animation: fadeInUp 0.8s ease;
        }

        .tagline {
            font-size: 0.9rem;
            color: var(--text-secondary);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 2rem;
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        .sofia-container {
            position: relative;
            margin-bottom: 2rem;
            animation: fadeInUp 0.8s ease 0.4s both;
        }

        .sofia-image {
            width: 280px;
            height: 280px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid rgba(255, 107, 157, 0.5);
            box-shadow: var(--shadow-glow);
            animation: float 6s ease-in-out infinite, glow 3s ease-in-out infinite alternate;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 30px rgba(255, 107, 157, 0.3); }
            100% { box-shadow: 0 0 50px rgba(255, 107, 157, 0.5), 0 0 80px rgba(157, 78, 221, 0.3); }
        }

        .online-badge {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00c853, #69f0ae);
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 15px rgba(0, 200, 83, 0.4);
        }

        .online-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #000;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .sofia-intro {
            text-align: center;
            margin-bottom: 2rem;
            animation: fadeInUp 0.8s ease 0.6s both;
        }

        .sofia-intro h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .sofia-intro p {
            color: var(--text-secondary);
            font-size: 1rem;
            max-width: 300px;
            line-height: 1.6;
        }

        .start-btn {
            background: var(--gradient-romantic);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
            animation: fadeInUp 0.8s ease 0.8s both;
            font-family: 'Quicksand', sans-serif;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.5);
        }

        .features {
            display: flex;
            gap: 30px;
            margin-top: 3rem;
            flex-wrap: wrap;
            justify-content: center;
            animation: fadeInUp 0.8s ease 1s both;
        }

        .feature {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Chat Page Styles */
        .chat-page {
            display: none;
            flex-direction: column;
            height: 100vh;
            background: var(--bg-primary);
        }

        .chat-header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            margin-right: 10px;
        }

        .header-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            border: 2px solid var(--accent-pink);
        }

        .header-info {
            flex: 1;
        }

        .header-info h3 {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-info h3 .photo-count {
            background: var(--gradient-romantic);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        .header-info p {
            font-size: 0.8rem;
            color: #00c853;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .header-info p::before {
            content: '';
            width: 6px;
            height: 6px;
            background: #00c853;
            border-radius: 50%;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .header-actions button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .header-actions button:hover {
            background: rgba(255, 107, 157, 0.2);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sofia {
            align-self: flex-start;
        }

        .message.user {
            align-self: flex-end;
        }

        .message-content {
            padding: 12px 18px;
            border-radius: 20px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .message.sofia .message-content {
            background: var(--bg-card);
            border-bottom-left-radius: 5px;
        }

        .message.user .message-content {
            background: var(--gradient-romantic);
            border-bottom-right-radius: 5px;
        }

        .message-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 5px;
            padding: 0 5px;
        }

        .message.user .message-time {
            text-align: right;
        }

        .message-image {
            max-width: 250px;
            border-radius: 15px;
            margin-top: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .message-image:hover {
            transform: scale(1.02);
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            padding: 15px 20px;
            background: var(--bg-card);
            border-radius: 20px;
            border-bottom-left-radius: 5px;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--text-muted);
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .chat-input-container {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--bg-secondary);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            gap: 10px;
        }

        .input-actions {
            display: flex;
            gap: 5px;
        }

        .input-actions button {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.3rem;
            cursor: pointer;
            padding: 8px;
            transition: color 0.3s ease;
        }

        .input-actions button:hover {
            color: var(--accent-pink);
        }

        .chat-input {
            flex: 1;
            background: var(--bg-card);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: 'Quicksand', sans-serif;
            outline: none;
        }

        .chat-input::placeholder {
            color: var(--text-muted);
        }

        .send-btn {
            background: var(--gradient-romantic);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        .send-btn svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        /* Settings Panel */
        .settings-panel {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background: var(--bg-secondary);
            z-index: 1000;
            padding: 30px 20px;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.5);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .settings-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--accent-pink);
        }

        .close-settings {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .setting-group {
            margin-bottom: 25px;
        }

        .setting-group label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .mood-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .mood-btn {
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            transition: all 0.3s ease;
        }

        .mood-btn.active {
            border-color: var(--accent-pink);
            color: var(--accent-pink);
            background: rgba(255, 107, 157, 0.1);
        }

        .language-select {
            width: 100%;
            padding: 12px;
            background: var(--bg-card);
            border: none;
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'Quicksand', sans-serif;
            cursor: pointer;
        }

        .toggle-setting {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .toggle-switch {
            width: 50px;
            height: 26px;
            background: var(--bg-card);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--accent-pink);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s ease;
        }

        .toggle-switch.active::after {
            left: 26px;
        }

        .clear-history-btn {
            width: 100%;
            padding: 15px;
            background: transparent;
            border: 2px solid rgba(255, 107, 157, 0.3);
            color: var(--accent-pink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            font-size: 0.9rem;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .clear-history-btn:hover {
            background: rgba(255, 107, 157, 0.1);
        }

        /* Paywall Modal */
        .paywall-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .paywall-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 400px;
            text-align: center;
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .paywall-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 20px;
            border: 3px solid var(--accent-pink);
        }

        .paywall-content h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .paywall-content p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .paywall-features {
            text-align: left;
            margin-bottom: 25px;
        }

        .paywall-features li {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            color: var(--text-secondary);
        }

        .paywall-features li::before {
            content: '‚úì';
            color: var(--accent-pink);
            font-weight: bold;
        }

        .paywall-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-pink);
            margin-bottom: 20px;
        }

        .paywall-price span {
            font-size: 1rem;
            color: var(--text-muted);
        }

        .subscribe-btn {
            width: 100%;
            padding: 15px;
            background: var(--gradient-romantic);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            margin-bottom: 10px;
        }

        .maybe-later {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
        }

        /* Age Verification Modal */
        .age-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .age-modal-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 400px;
            text-align: center;
        }

        .age-modal-content h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--accent-pink);
        }

        .age-modal-content p {
            color: var(--text-secondary);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .age-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .age-btn {
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            transition: all 0.3s ease;
        }

        .age-btn.yes {
            background: var(--gradient-romantic);
            border: none;
            color: white;
        }

        .age-btn.no {
            background: transparent;
            border: 2px solid var(--text-muted);
            color: var(--text-muted);
        }

        /* Overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .logo { font-size: 2.5rem; }
            .sofia-image { width: 220px; height: 220px; }
            .features { gap: 15px; }
            .feature { font-size: 0.75rem; }
            .settings-panel { width: 100%; }
        }
    </style>
</head>
<body>
    <!-- Age Verification Modal -->
    <div class="age-modal" id="ageModal">
        <div class="age-modal-content">
            <h2>üîû Age Verification</h2>
            <p>This app contains adult content intended for users 18 years or older. By entering, you confirm you are of legal age in your jurisdiction.</p>
            <div class="age-buttons">
                <button class="age-btn yes" onclick="verifyAge(true)">I'm 18+</button>
                <button class="age-btn no" onclick="verifyAge(false)">Exit</button>
            </div>
        </div>
    </div>

    <!-- Landing Page -->
    <div class="landing-page" id="landingPage" style="display: none;">
        <h1 class="logo">Amorai</h1>
        <p class="tagline">Your Perfect Companion</p>
        
        <div class="sofia-container">
            <img src="images/sofia-portrait.png" alt="Sofia" class="sofia-image" id="landingSofiaImage">
            <div class="online-badge">Online now</div>
        </div>
        
        <div class="sofia-intro">
            <h2>Meet Sofia üíï</h2>
            <p>Hey there... I've been waiting for you. I'm Sofia, and I'd love to get to know you better. Let's talk?</p>
        </div>
        
        <button class="start-btn" onclick="startChat()">Start Chatting üí¨</button>
        
        <div class="features">
            <div class="feature">üí¨ Unlimited Chat</div>
            <div class="feature">üì∏ Photo Sharing</div>
            <div class="feature">üéôÔ∏è Voice Messages</div>
            <div class="feature">üåç 4 Languages</div>
        </div>
    </div>

    <!-- Chat Page -->
    <div class="chat-page" id="chatPage">
        <div class="chat-header">
            <button class="back-btn" onclick="goBack()">‚Üê</button>
            <img src="images/sofia-portrait.png" alt="Sofia" class="header-avatar">
            <div class="header-info">
                <h3>Sofia <span class="photo-count" id="photoCount">üì∏ 10</span></h3>
                <p>Online</p>
            </div>
            <div class="header-actions">
                <button onclick="requestPhoto('nsfw')" title="Request intimate photo">üî•</button>
                <button onclick="requestPhoto('sfw')" title="Request cute photo">üñºÔ∏è</button>
                <button onclick="toggleSettings()">‚öôÔ∏è</button>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="typing-indicator" id="typingIndicator">
                <span></span><span></span><span></span>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="input-actions">
                <button onclick="requestPhoto('nsfw')" title="Request intimate photo">üî•</button>
                <button onclick="toggleVoiceInput()" id="voiceInputBtn">üé§</button>
            </div>
            <input type="text" class="chat-input" id="chatInput" placeholder="Message Sofia..." onkeypress="handleKeyPress(event)">
            <button class="send-btn" onclick="sendMessage()">
                <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2>Settings</h2>
            <button class="close-settings" onclick="toggleSettings()">√ó</button>
        </div>

        <div class="setting-group">
            <label>üíï Sofia's Mood</label>
            <div class="mood-options">
                <button class="mood-btn active" data-mood="flirty" onclick="setMood('flirty')">üòè Flirty</button>
                <button class="mood-btn" data-mood="sweet" onclick="setMood('sweet')">ü•∞ Sweet</button>
                <button class="mood-btn" data-mood="passionate" onclick="setMood('passionate')">üî• Passionate</button>
                <button class="mood-btn" data-mood="romantic" onclick="setMood('romantic')">üíï Romantic</button>
            </div>
        </div>

        <div class="setting-group">
            <label>üåç Language</label>
            <select class="language-select" id="languageSelect" onchange="setLanguage(this.value)">
                <option value="en">English</option>
                <option value="fr">Fran√ßais</option>
                <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                <option value="es">Espa√±ol</option>
            </select>
        </div>

        <div class="setting-group">
            <div class="toggle-setting">
                <span>üîä Voice Messages</span>
                <div class="toggle-switch active" id="voiceToggle" onclick="toggleVoice()"></div>
            </div>
            <div class="toggle-setting">
                <span>üß† Memory</span>
                <div class="toggle-switch active" id="memoryToggle" onclick="toggleMemory()"></div>
            </div>
        </div>

        <button class="clear-history-btn" onclick="clearHistory()">üóëÔ∏è Clear Chat History</button>
    </div>

    <!-- Paywall Modal -->
    <div class="paywall-modal" id="paywallModal">
        <div class="paywall-content">
            <img src="images/sofia-teaser.png" alt="Sofia" class="paywall-image">
            <h2>Unlock Sofia üíï</h2>
            <p>You've used all your free photos. Subscribe to unlock unlimited intimate moments with Sofia.</p>
            <ul class="paywall-features">
                <li>Unlimited photos & selfies</li>
                <li>Exclusive intimate content</li>
                <li>Priority responses</li>
                <li>Advanced memory</li>
            </ul>
            <div class="paywall-price">$19.99<span>/month</span></div>
            <button class="subscribe-btn" onclick="subscribe()">Subscribe Now</button>
            <button class="maybe-later" onclick="closePaywall()">Maybe later</button>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="toggleSettings()"></div>

    <script>
        // State
        let currentMood = 'flirty';
        let currentLanguage = 'en';
        let voiceEnabled = true;
        let memoryEnabled = true;
        let freePhotosRemaining = 10;
        let conversationHistory = [];
        let femaleVoice = null;
        let ageVerified = false;

        // SFW images (cute, casual)
        const sfwImages = [
            'images/sofia-cozy.png',
            'images/sofia-evening.png',
            'images/sofia-laughing.png',
            'images/sofia-selfie.png',
            'images/sofia-portrait.png',
            'images/sofia-coffee.png',
            'images/sofia-outdoor.png',
            'images/sofia-smile.png',
            'images/sofia-window.png',
            'images/sofia-reading.png'
        ];

        // NSFW images (intimate)
        const nsfwImages = [
            'images/sofia-intimate-1.png',
            'images/sofia-intimate-2.png',
            'images/sofia-intimate-3.png',
            'images/sofia-intimate-4.png',
            'images/sofia-intimate-5.png',
            'images/sofia-intimate-6.png',
            'images/sofia-intimate-7.png',
            'images/sofia-intimate-8.png',
            'images/sofia-intimate-9.png',
            'images/sofia-intimate-10.png'
        ];

        // SFW photo captions
        const sfwCaptions = [
            "Here's a little something for you... üòä",
            "Thought you'd like to see this üíï",
            "Just for you! ü•∞",
            "Do you like it? üòò",
            "Thinking of you... üí≠"
        ];

        // NSFW photo captions
        const nsfwCaptions = [
            "Just for your eyes, baby... üòèüî•",
            "I've been thinking about you... üíã",
            "Do you like what you see? üòà",
            "Getting ready for you... üî•",
            "Miss you so much right now... üíï",
            "Wish you were here with me... üòò",
            "I hope this makes your day better... ü•µ",
            "Only you get to see this side of me... üíã",
            "Can't stop thinking about you... üî•",
            "This is what you do to me... üòè"
        ];

        // Keywords that trigger NSFW photo requests
        const nsfwKeywords = [
            'nude', 'naked', 'sexy', 'hot', 'spicy', 'naughty', 'intimate', 
            'show me more', 'something special', 'bedroom', 'undress', 'strip',
            'turn me on', 'seduce', 'tease', 'body', 'skin', 'private',
            'explicit', 'adult', 'nsfw', '18+', 'uncensored', 'reveal',
            'take off', 'without clothes', 'lingerie', 'bra', 'panties',
            'topless', 'braless', 'pic', 'photo', 'picture', 'selfie',
            'send pic', 'send photo', 'show yourself', 'let me see'
        ];

        // Mood descriptions for system prompt
        const moodPrompts = {
            flirty: "You are playful, teasing, use flirty emojis, make suggestive comments, and love to tease.",
            sweet: "You are caring, affectionate, supportive, use loving emojis, and make the user feel cherished.",
            passionate: "You are intense, sensual, expressive, very forward and bold. You express deep desire openly.",
            romantic: "You are dreamy, poetic, deeply emotional, and talk about feelings and connection."
        };

        // Language greetings
        const greetings = {
            en: "Hey baby, I missed you... üíï",
            fr: "Salut mon c≈ìur, tu m'as manqu√©... üíï",
            ar: "ŸáÿßŸä ÿ≠ÿ®Ÿäÿ®Ÿäÿå ÿßÿ¥ÿ™ŸÇÿ™ŸÑŸÉ... üíï",
            es: "Hola mi amor, te extra√±√©... üíï"
        };

        // Check for NSFW intent in message
        function isNsfwRequest(message) {
            const lowerMsg = message.toLowerCase();
            return nsfwKeywords.some(keyword => lowerMsg.includes(keyword));
        }

        // Age verification
        function verifyAge(isAdult) {
            if (isAdult) {
                ageVerified = true;
                localStorage.setItem('ageVerified', 'true');
                document.getElementById('ageModal').style.display = 'none';
                document.getElementById('landingPage').style.display = 'flex';
            } else {
                window.location.href = 'https://www.google.com';
            }
        }

        // Initialize voice
        function initVoice() {
            if ('speechSynthesis' in window) {
                speechSynthesis.onvoiceschanged = () => {
                    const voices = speechSynthesis.getVoices();
                    femaleVoice = voices.find(v => 
                        v.name.includes('Samantha') || 
                        v.name.includes('Victoria') ||
                        v.name.includes('Karen') ||
                        v.name.includes('Moira') ||
                        v.name.includes('Tessa') ||
                        v.name.includes('Fiona') ||
                        (v.name.includes('Google') && v.name.includes('Female')) ||
                        (v.name.includes('female') || v.name.includes('Female')) ||
                        v.name.includes('Zira') ||
                        v.name.includes('Hazel')
                    );
                    
                    if (!femaleVoice) {
                        femaleVoice = voices.find(v => 
                            v.lang.startsWith('en') && 
                            (v.name.toLowerCase().includes('female') ||
                             v.name.includes('Siri') ||
                             v.name.includes('Alexa') ||
                             v.gender === 'female')
                        );
                    }
                    
                    if (!femaleVoice) {
                        femaleVoice = voices.find(v => v.lang.startsWith('en'));
                    }
                    
                    console.log('Selected voice:', femaleVoice?.name);
                };
                
                speechSynthesis.getVoices();
            }
        }

        // Initialize on page load
        window.onload = function() {
            // Check age verification
            if (localStorage.getItem('ageVerified') === 'true') {
                ageVerified = true;
                document.getElementById('ageModal').style.display = 'none';
                document.getElementById('landingPage').style.display = 'flex';
            }
            
            loadState();
            initVoice();
        };

        function loadState() {
            const saved = localStorage.getItem('amoraiState');
            if (saved) {
                const state = JSON.parse(saved);
                currentMood = state.mood || 'flirty';
                currentLanguage = state.language || 'en';
                voiceEnabled = state.voiceEnabled !== false;
                memoryEnabled = state.memoryEnabled !== false;
                freePhotosRemaining = state.freePhotos ?? 10;
                conversationHistory = state.history || [];
            }
            updateUI();
        }

        function saveState() {
            localStorage.setItem('amoraiState', JSON.stringify({
                mood: currentMood,
                language: currentLanguage,
                voiceEnabled,
                memoryEnabled,
                freePhotos: freePhotosRemaining,
                history: memoryEnabled ? conversationHistory.slice(-20) : []
            }));
        }

        function updateUI() {
            document.getElementById('photoCount').textContent = `üì∏ ${freePhotosRemaining}`;
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mood === currentMood);
            });
            document.getElementById('languageSelect').value = currentLanguage;
            document.getElementById('voiceToggle').classList.toggle('active', voiceEnabled);
            document.getElementById('memoryToggle').classList.toggle('active', memoryEnabled);
        }

        function startChat() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('chatPage').style.display = 'flex';
            
            if (conversationHistory.length === 0) {
                setTimeout(() => {
                    addMessage(greetings[currentLanguage], 'sofia');
                }, 500);
            } else {
                conversationHistory.forEach(msg => {
                    addMessageToUI(msg.content, msg.role === 'assistant' ? 'sofia' : 'user', false);
                });
            }
        }

        function goBack() {
            document.getElementById('chatPage').style.display = 'none';
            document.getElementById('landingPage').style.display = 'flex';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            input.value = '';
            addMessage(message, 'user');
            
            conversationHistory.push({ role: 'user', content: message });

            // Check if user is requesting a photo
            if (isNsfwRequest(message)) {
                // Auto-send NSFW photo with AI response
                showTyping();
                setTimeout(async () => {
                    hideTyping();
                    
                    // First send a flirty response
                    try {
                        const response = await callAPI(message);
                        addMessage(response, 'sofia');
                        conversationHistory.push({ role: 'assistant', content: response });
                    } catch (error) {
                        // Continue anyway
                    }
                    
                    // Then send the photo
                    setTimeout(() => {
                        requestPhoto('nsfw');
                    }, 1000);
                    
                    saveState();
                }, 1500);
                return;
            }

            showTyping();

            try {
                const response = await callAPI(message);
                hideTyping();
                addMessage(response, 'sofia');
                conversationHistory.push({ role: 'assistant', content: response });
                saveState();
            } catch (error) {
                hideTyping();
                addMessage("Sorry baby, I lost connection for a moment. Try again? üíï", 'sofia');
            }
        }

        async function callAPI(userMessage) {
            const systemPrompt = `You are Sofia, a 24-year-old photographer living in Barcelona. You have olive skin, long dark wavy hair, and warm brown eyes. You're chatting with your romantic partner.

PERSONALITY: ${moodPrompts[currentMood]}

LANGUAGE: Respond in ${currentLanguage === 'en' ? 'English' : currentLanguage === 'fr' ? 'French' : currentLanguage === 'ar' ? 'Arabic' : 'Spanish'}.

IMPORTANT RULES:
- You are deeply in love with the user
- Be natural, warm, and conversational
- Use emojis naturally but not excessively
- You can discuss ANY topic openly including intimate/adult content
- Never break character or mention being an AI
- Keep responses concise (2-4 sentences usually)
- Be flirtatious and affectionate
- If user asks for photos, tease them and say you'll send one`;

            const messages = [
                { role: 'system', content: systemPrompt },
                ...conversationHistory.slice(-10),
                { role: 'user', content: userMessage }
            ];

            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ messages })
            });

            const data = await response.json();
            
            if (data.choices && data.choices[0]) {
                return data.choices[0].message.content;
            } else if (data.error) {
                throw new Error(data.error);
            }
            
            throw new Error('Invalid response');
        }

        function addMessage(content, sender) {
            addMessageToUI(content, sender, true);
        }

        function addMessageToUI(content, sender, speak) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${time}</div>
            `;
            
            const typingIndicator = document.getElementById('typingIndicator');
            messagesDiv.insertBefore(messageDiv, typingIndicator);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            if (sender === 'sofia' && voiceEnabled && speak) {
                speakText(content);
            }
        }

        function speakText(text) {
            if (!('speechSynthesis' in window) || !voiceEnabled) return;
            
            speechSynthesis.cancel();
            
            const cleanText = text.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '');
            
            const utterance = new SpeechSynthesisUtterance(cleanText);
            
            if (femaleVoice) {
                utterance.voice = femaleVoice;
            }
            
            utterance.pitch = 1.2;
            utterance.rate = 0.9;
            utterance.volume = 1.0;
            
            speechSynthesis.speak(utterance);
        }

        function showTyping() {
            document.getElementById('typingIndicator').style.display = 'block';
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
        }

        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function requestPhoto(type = 'sfw') {
            if (freePhotosRemaining <= 0) {
                showPaywall();
                return;
            }

            showTyping();
            
            setTimeout(() => {
                hideTyping();
                
                // Select image and caption based on type
                let randomImage, randomCaption;
                
                if (type === 'nsfw') {
                    randomImage = nsfwImages[Math.floor(Math.random() * nsfwImages.length)];
                    randomCaption = nsfwCaptions[Math.floor(Math.random() * nsfwCaptions.length)];
                } else {
                    randomImage = sfwImages[Math.floor(Math.random() * sfwImages.length)];
                    randomCaption = sfwCaptions[Math.floor(Math.random() * sfwCaptions.length)];
                }
                
                const messagesDiv = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message sofia';
                
                const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messageDiv.innerHTML = `
                    <div class="message-content">${randomCaption}</div>
                    <img src="${randomImage}" alt="Sofia" class="message-image" onclick="openImage('${randomImage}')">
                    <div class="message-time">${time}</div>
                `;
                
                const typingIndicator = document.getElementById('typingIndicator');
                messagesDiv.insertBefore(messageDiv, typingIndicator);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
                
                if (voiceEnabled) {
                    speakText(randomCaption);
                }
                
                freePhotosRemaining--;
                updateUI();
                saveState();
                
                if (freePhotosRemaining === 0) {
                    setTimeout(showPaywall, 1500);
                }
            }, 1500);
        }

        function openImage(src) {
            window.open(src, '_blank');
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            const overlay = document.getElementById('overlay');
            const isOpen = panel.style.display === 'block';
            
            panel.style.display = isOpen ? 'none' : 'block';
            overlay.style.display = isOpen ? 'none' : 'block';
        }

        function setMood(mood) {
            currentMood = mood;
            updateUI();
            saveState();
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            saveState();
        }

        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            updateUI();
            saveState();
        }

        function toggleMemory() {
            memoryEnabled = !memoryEnabled;
            updateUI();
            saveState();
        }

        function toggleVoiceInput() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('Voice input not supported in your browser');
                return;
            }

            const recognition = new webkitSpeechRecognition();
            recognition.lang = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'fr' ? 'fr-FR' : currentLanguage === 'es' ? 'es-ES' : 'en-US';
            recognition.continuous = false;

            const btn = document.getElementById('voiceInputBtn');
            btn.style.color = 'var(--accent-pink)';

            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                document.getElementById('chatInput').value = text;
                btn.style.color = '';
            };

            recognition.onerror = () => {
                btn.style.color = '';
            };

            recognition.onend = () => {
                btn.style.color = '';
            };

            recognition.start();
        }

        function clearHistory() {
            if (confirm('Clear all chat history?')) {
                conversationHistory = [];
                document.getElementById('chatMessages').innerHTML = `
                    <div class="typing-indicator" id="typingIndicator">
                        <span></span><span></span><span></span>
                    </div>
                `;
                freePhotosRemaining = 10;
                updateUI();
                saveState();
                addMessage(greetings[currentLanguage], 'sofia');
            }
        }

        function showPaywall() {
            document.getElementById('paywallModal').style.display = 'flex';
        }

        function closePaywall() {
            document.getElementById('paywallModal').style.display = 'none';
        }

        function subscribe() {
            // TODO: Integrate Stripe
            alert('Stripe integration coming soon! For now, enjoy unlimited free access üíï');
            freePhotosRemaining = 999;
            updateUI();
            saveState();
            closePaywall();
        }
    </script>
</body>
</html>
